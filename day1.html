<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Fitness Tracker</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{font-family:-apple-system;background:#f2f2f7;padding:20px;margin:0}
.card{background:#fff;padding:15px;margin:15px 0;border-radius:12px}
button,input,select{width:100%;padding:10px;margin-top:6px;font-size:15px}
button{background:#007aff;color:#fff;border:none;border-radius:10px}
.exercise{margin-top:12px}
.sets{display:flex;gap:6px;flex-wrap:wrap;}
.sets input{flex:1; min-width:60px;}
.small{font-size:13px;color:#666}
.timer{font-size:22px;font-weight:bold;text-align:center;margin-top:10px}
canvas{margin-top:10px;background:#f9f9f9;border-radius:8px;padding:10px}
.gym-count{font-size:48px;font-weight:bold;text-align:center;color:#007aff}
.gym-streak{text-align:center;color:#666;margin-bottom:10px}
.history-list{max-height:200px;overflow-y:auto;margin-top:10px}
.history-item{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #eee}
.history-item:last-child{border-bottom:none}
.day-tag{background:#e8f4ff;color:#007aff;padding:2px 8px;border-radius:6px;font-size:12px}
.toggle-btn{background:#f2f2f7;color:#007aff;margin-top:10px}
.clear-btn{background:#ff3b30;margin-top:10px}
</style>
</head>
<body>

<h2>üèãÔ∏è Fitness Tracker</h2>
<p class="small">5-Day Strength + Optional Day 6 Cardio/Stretch ‚Ä¢ Mini Bar Charts ‚Ä¢ Local Only</p>

<!-- Gym History Counter -->
<div class="card">
<h3>üî• Gym Attendance</h3>
<div class="gym-count" id="gymCount">0</div>
<div class="gym-streak">Total Gym Days</div>
<div id="currentStreak" class="small" style="text-align:center;margin-bottom:10px"></div>
<button class="toggle-btn" id="toggleHistory">Show History</button>
<div class="history-list" id="gymHistoryList" style="display:none"></div>
<button class="clear-btn" id="clearHistory" style="display:none">Clear History</button>
</div>

<!-- Day Dropdown -->
<div class="card">
<h3>üìÖ Workout Day</h3>
<select id="daySelect"></select>
</div>

<!-- Daily Warm-up -->
<div class="card">
<h3>üî• Daily Warm-Up (10 min)</h3>
<p class="small">
5 min treadmill / bike / elliptical<br>
Arm circles √ó20<br>
Leg swings √ó15/leg<br>
Hip circles √ó10<br>
Bodyweight squats √ó15
</p>
<button id="warmupBtn">Warm-Up Done</button>
</div>

<!-- Rest Timer -->
<div class="card">
<h3>‚è± Rest Timer (60s)</h3>
<div id="timer" class="timer">60</div>
<button id="resetTimer">Reset</button>
</div>

<!-- Workout Area -->
<div class="card" id="workoutArea"></div>

<!-- Body Weight -->
<div class="card">
<h3>‚öñÔ∏è Body Weight</h3>
<input id="bodyWeight" type="number" placeholder="Enter body weight">
<button id="saveWeight">Save</button>
</div>

<!-- Charts -->
<div class="card">
<h3>üìä Today's Progress</h3>
<canvas id="chartArea"></canvas>
</div>

<script>
// -------- Variables --------
const today = new Date().toLocaleDateString();
let timerInterval, timeLeft=60, chartInstance;

const days = {
  day1: "Day 1 ‚Äì Upper (Push + Pull)",
  day2: "Day 2 ‚Äì Lower",
  day3: "Day 3 ‚Äì Cardio + Core",
  day4: "Day 4 ‚Äì Upper (Angles)",
  day5: "Day 5 ‚Äì Lower + Core",
  day6: "Day 6 ‚Äì Optional Cardio / Stretch"
};

const workouts = {
  day1:[["Chest Press",3],["Pec Deck",3],["Lat Pulldown",3],["Seated Row",3],["Shoulder Press",3],["Lateral Raise Machine",3],["Triceps Pushdown",3],["Biceps Curl Machine",3]],
  day2:[["Leg Press",4],["Seated Leg Curl",3],["Leg Extension",3],["Hip Abductor",3],["Calf Raise",4]],
  day3:[["Ab Crunch Machine",3],["Cable Woodchoppers (each side)",3],["Plank (seconds)",3]],
  day4:[["Incline Chest Press",3],["Assisted Pull-Up / Wide Pulldown",3],["Rear Delt Fly",3],["Shoulder Press",3],["Face Pull",3],["Assisted Dips",3],["Preacher Curl Machine",3]],
  day5:[["Hack Squat / Leg Press",4],["RDL Machine / Lying Curl",3],["Walking Lunges (per leg)",3],["Hip Thrust / Glute Bridge",3],["Calf Raise",4],["Hanging Knee Raises",3],["Plank (seconds)",3]],
  day6:[["Cardio Type / Duration",0],["Stretching Exercises / Duration",0]]
};

const postWorkout = {
  day1:["Cardio Type","Cardio Minutes"],
  day2:["Cardio Type","Cardio Minutes"],
  day3:["Cardio Type","Cardio Minutes","Core Exercise","Core Sets / Duration"],
  day4:["Cardio Type","Cardio Minutes"],
  day5:["Cardio Type","Cardio Minutes","Core Exercise","Core Sets / Duration"],
  day6:["Cardio Type","Cardio Minutes","Stretching Exercises","Stretch Duration"]
};

// -------- Timer --------
function startTimer(){
  clearInterval(timerInterval);
  timeLeft=60;
  document.getElementById("timer").textContent=timeLeft;
  timerInterval=setInterval(()=>{
    timeLeft--;
    document.getElementById("timer").textContent = timeLeft<=0?"Rest Over!":timeLeft;
    if(timeLeft<=0) clearInterval(timerInterval);
  },1000);
}
document.getElementById("resetTimer").addEventListener("click",()=>{
  timeLeft=60; document.getElementById("timer").textContent=60; clearInterval(timerInterval);
});

// -------- LocalStorage --------
function getLog(){ return JSON.parse(localStorage.getItem(today)||"{}"); }
function saveLog(d){ localStorage.setItem(today,JSON.stringify(d)); renderChart(); }

// -------- Gym History --------
function getGymHistory(){
  return JSON.parse(localStorage.getItem("gymHistory")||"[]");
}

function saveGymVisit(dayType){
  const history = getGymHistory();
  const existingIndex = history.findIndex(h => h.date === today);
  
  if(existingIndex === -1){
    history.push({date: today, day: dayType, timestamp: Date.now()});
  } else {
    history[existingIndex].day = dayType;
  }
  
  localStorage.setItem("gymHistory", JSON.stringify(history));
  renderGymHistory();
}

function calculateStreak(){
  const history = getGymHistory();
  if(history.length === 0) return 0;
  
  const dates = history.map(h => new Date(h.date)).sort((a,b) => b-a);
  let streak = 0;
  let checkDate = new Date();
  checkDate.setHours(0,0,0,0);
  
  for(let i=0; i<dates.length; i++){
    const visitDate = new Date(dates[i]);
    visitDate.setHours(0,0,0,0);
    
    const diffDays = Math.floor((checkDate - visitDate) / (1000*60*60*24));
    
    if(diffDays <= 1){
      streak++;
      checkDate = visitDate;
    } else {
      break;
    }
  }
  return streak;
}

function renderGymHistory(){
  const history = getGymHistory();
  const count = history.length;
  const streak = calculateStreak();
  
  document.getElementById("gymCount").textContent = count;
  document.getElementById("currentStreak").innerHTML = streak > 1 ? `üî• ${streak} day streak!` : "";
  
  const list = document.getElementById("gymHistoryList");
  if(history.length === 0){
    list.innerHTML = "<p class='small' style='text-align:center;padding:20px'>No gym visits recorded yet.<br>Complete a workout to start tracking!</p>";
  } else {
    const sorted = [...history].sort((a,b) => b.timestamp - a.timestamp);
    list.innerHTML = sorted.map(h => `
      <div class="history-item">
        <span>${h.date}</span>
        <span class="day-tag">${days[h.day] ? days[h.day].split("‚Äì")[0].trim() : h.day}</span>
      </div>
    `).join("");
  }
}

// Toggle history visibility
let historyVisible = false;
document.getElementById("toggleHistory").addEventListener("click", ()=>{
  historyVisible = !historyVisible;
  document.getElementById("gymHistoryList").style.display = historyVisible ? "block" : "none";
  document.getElementById("clearHistory").style.display = historyVisible ? "block" : "none";
  document.getElementById("toggleHistory").textContent = historyVisible ? "Hide History" : "Show History";
});

// Clear history
document.getElementById("clearHistory").addEventListener("click", ()=>{
  if(confirm("Are you sure you want to clear all gym history? This cannot be undone.")){
    localStorage.removeItem("gymHistory");
    renderGymHistory();
  }
});

// -------- Warmup --------
document.getElementById("warmupBtn").addEventListener("click",()=>{
  const l=getLog(); l.warmup="Done"; saveLog(l);
});

// -------- Body Weight --------
document.getElementById("saveWeight").addEventListener("click",()=>{
  const l=getLog(); l.bodyWeight=document.getElementById("bodyWeight").value; saveLog(l);
});

// -------- Populate dropdown --------
const daySelect = document.getElementById("daySelect");
for(const key in days){
  const opt = document.createElement("option");
  opt.value = key;
  opt.textContent = days[key];
  daySelect.appendChild(opt);
}

// -------- Render Workout --------
function renderWorkout(){
  const day = daySelect.value;
  const area=document.getElementById("workoutArea");
  area.innerHTML="<h3>üèãÔ∏è Workout</h3>";

  const lastSession = JSON.parse(localStorage.getItem(day+"_lastSession")||"{}");

  // Exercises
  workouts[day].forEach(ex=>{
    const div=document.createElement("div"); div.className="exercise";
    const title=document.createElement("b"); title.textContent=ex[0]; div.appendChild(title);

    if(ex[1]>0){
      const setDiv=document.createElement("div"); setDiv.className="sets";
      lastSession[ex[0]]=lastSession[ex[0]]||[];
      for(let i=0;i<ex[1];i++){
        const input=document.createElement("input");
        input.placeholder="Set "+(i+1);
        input.value=lastSession[ex[0]][i]||"";
        input.addEventListener("input", startTimer);
        setDiv.appendChild(input);
      }
      div.appendChild(setDiv);
    } else {
      const input=document.createElement("input");
      input.placeholder="Type / Duration";
      input.value=lastSession[ex[0]]||"";
      input.addEventListener("input", startTimer);
      div.appendChild(input);
    }
    area.appendChild(div);
  });

  // Post-workout
  if(postWorkout[day]){
    const postDiv=document.createElement("div"); postDiv.className="exercise";
    const postTitle=document.createElement("b"); postTitle.textContent="üèÅ Post-Workout Cardio / Core / Stretch";
    postDiv.appendChild(postTitle);
    postWorkout[day].forEach(item=>{
      const input=document.createElement("input");
      input.placeholder=item;
      input.value=lastSession[item]||"";
      input.addEventListener("input", startTimer);
      postDiv.appendChild(input);
    });
    area.appendChild(postDiv);
  }

  // Save button
  const btn=document.createElement("button"); btn.textContent="Save Workout";
  btn.onclick=()=>saveWorkout(day);
  area.appendChild(btn);

  renderChart();
}

// -------- Save Workout --------
function saveWorkout(day){
  const area=document.getElementById("workoutArea");
  const inputs=[...area.querySelectorAll("input")];
  let lastSession={}, index=0;

  workouts[day].forEach(ex=>{
    if(ex[1]>0){
      lastSession[ex[0]]=[];
      for(let i=0;i<ex[1];i++){
        lastSession[ex[0]].push(inputs[index++]?.value||"");
      }
    } else {
      lastSession[ex[0]]=inputs[index++]?.value||"";
    }
  });

  if(postWorkout[day]){
    postWorkout[day].forEach(item=>{
      lastSession[item]=inputs[index++]?.value||"";
    });
  }

  localStorage.setItem(day+"_lastSession", JSON.stringify(lastSession));

  // Also store today's log
  const todayLog=getLog();
  todayLog.workout=lastSession;
  saveLog(todayLog);
  
  // Save gym visit to history
  saveGymVisit(day);
  
  alert("Workout saved! üí™");
}

// -------- Chart --------
function renderChart(){
  const day=daySelect.value;
  const l=getLog();
  const ctx=document.getElementById("chartArea").getContext("2d");

  const lastWeek=JSON.parse(localStorage.getItem(day+"_lastWeek")||"{}");

  let labels=[], lastWeekData=[], thisWeekData=[];

  workouts[day].forEach(ex=>{
    if(ex[1]>0){
      for(let i=0;i<ex[1];i++){
        labels.push(ex[0]+" Set "+(i+1));
        let lw=lastWeek[ex[0]]?Number(lastWeek[ex[0]][i]||0):0;
        let tw=l.workout && l.workout[ex[0]]?Number(l.workout[ex[0]][i]||0):0;
        lastWeekData.push(lw);
        thisWeekData.push(tw);
      }
    }
  });

  if(postWorkout[day]){
    postWorkout[day].forEach(item=>{
      labels.push(item);
      let lw=lastWeek[item]?Number(lastWeek[item]||0):0;
      let tw=l.workout && l.workout[item]?Number(l.workout[item]||0):0;
      lastWeekData.push(lw);
      thisWeekData.push(tw);
    });
  }

  if(chartInstance) chartInstance.destroy();
  chartInstance=new Chart(ctx,{
    type:"bar",
    data:{labels:labels,datasets:[
      {label:"Last Week", data:lastWeekData, backgroundColor:"rgba(0,123,255,0.4)"},
      {label:"This Week", data:thisWeekData, backgroundColor:"rgba(0,123,255,1)"}
    ]},
    options:{responsive:true,plugins:{legend:{position:"top"}},scales:{y:{beginAtZero:true}}}
  });
}

// -------- Initialize --------
daySelect.value="day1";
daySelect.addEventListener("change", renderWorkout);
renderWorkout();
renderGymHistory();
</script>

</body>
</html>
